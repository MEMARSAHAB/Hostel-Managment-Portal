<div style="overflow: hidden;">
  <div class="admin-header shadows">
    <%- include('partials/header'); -%> <%- include('partials/admin-sidenav');
    -%>
  </div>
  <div class="start-h2" style="height: 0px;">
    <a
      style="z-index: 1000;"
      class="search-icon"
      href="/admin/dashboard/details"
      ><i class="material-icons back-icon">search</i></a
    >
  </div>

  <div id="notifications" class="jumbotron-admin alerts">
    <div class="alert-content">
      <h3 style="color: #1c4f6c;" class="notif-heading underline">
        Notifications
      </h3>
      <div class="admin-image">
        <img src="/images/notification.svg" />
      </div>
      <div class="dropdown">
        <h5>Application Type:</h5>
        <select id="hello" name="status">
          <option value="applied">Leave Applications</option>
          <option value="recent">Recent Applications</option>
        </select>
        <br />
      </div>
      <br />
      <ul class="collapsible expandible" id="lola"></ul>
    </div>
  </div>
  <br /><br />

  <div style="height: 60px; width: 100%;"></div>
</div>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    var elems = document.querySelectorAll(".collapsible");
    var instances = M.Collapsible.init(elems, { accordion: false });
  });
  function fetchLeaves(opt) {
    fetch(`/admin/data/leaves?status=${opt}`).then(response => {
      if (response.status !== 200) {
        console.log(
          "Looks like there was a problem. Status Code: " + response.status
        );
        return;
      }
      response.json().then(function(data) {
        $("#lola").empty();
        console.log(data);
        if (data.leaves.length == 0) {
          $("#lola").html(
            `<div
          class="collapsible-header"
          style="display: flex; align-items: center;pointer-events: none;"
        >
          <i class="material-icons">notifications_off</i>
          <span
            style="position: absolute;left: 50%; transform: translate(-50%);color: #052c66;"
            >No Notifications</span
          >
        </div>`
          );
        } else {
          data.leaves.forEach(leave => {
            var render = "",
              render2 = "";
            if (leave.Approve == undefined) {
              render = `<div class="appr-rej">
                    <button class="btn blue darken-1" value="${leave._id}" id="accept">Approve</button>
                     
                    <button class="btn red accent-2" value="${leave._id}"  id="reject" style="background-color: #052c66;">Reject </button>
                </div>`;
              render2 = `<button class="btn blue darken-1" value="${leave._id}" id="accept2">Approve</button><button class="btn red accent-2" value="${leave._id}"  id="reject2" style="background-color: #052c66;">Reject </button>`;
            } else if (leave.Approve) {
              render2 = render = `<button class="btn green darken-2">Approved</button>`;
            } else {
              render2 = render = `<button class="btn red accent-2">Rejected</button>`;
            }
            $("#lola").append(
              `
            <li>
                <div class="collapsible-header" style="display: flex; align-items: center;">
            <i class="material-icons"> notifications_active </i> <span style="color: #052c66;display: flex;align-items: center;">
              <span class="material-icons notifi-name" style="font-size: 20px;">person</span>&nbsp;${leave.Name}</span>
            <span class="no-days" style="position: absolute;left: 50%;transform: translate(-50%);" >Days : /*number*/</span>
            <span style="position: absolute;right: 10%;">
              <div class="hide-on-mobile">` +
                render +
                `</div>
            </span>
          </div>
          <div class="collapsible-body">
            <strong style="color: #052c66;">Email:</strong>
            <p>${leave.Email}</p><strong style="color: #052c66;">Leave Date:</strong><p>${leave.Leave}</p>
            <strong style="color: #052c66;">Return Date:</strong> <p>${leave.Return}</p> <strong style="color: #052c66;">Reason:</strong> <p>${leave.Reason}</p> <div class="view-on-mobile">` +
                render2 +
                `</div> </div> </li>`
            );
          });
        }
      });
    });
  }
 
   function accept(y,x){
     fetch(`/admin/dashboard/permit?approve=${y}&_id=${x}`).then(response => {
         response.json().then(function(data){
             //Remove the parent to that button
            //  $("accept").closest().remove();
         });
     });
   }
   function reject(){
    fetch(`/admin/dashboard/permit?approve=${y}&_id=${x}`).then(response => {
         response.json().then(function(data){
           
         });
     });
   }

   $(document).ready(function() {
    fetchLeaves("applied");
    $("#hello").change(function() {
      var selectedOption = $(this)
        .children("option:selected")
        .val();
      fetchLeaves(selectedOption);
    });
      $("#reject").click(function(){
            const z=$(this).val();
            reject("false",z);
      });
      $("#accept").click(function(){
          const z=$(this).val();
          accept("true",z);
      });
});
  
  
  

</script>
<%- include('partials/footer'); -%>